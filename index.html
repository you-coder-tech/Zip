<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداة فك ضغط الملفات (ZIP & RAR)</title>
    <!-- مكتبة فك ضغط ZIP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- مكتبة فك ضغط RAR (تعتمد على WebAssembly) -->
    <script src="https://unpkg.com/rar-stream/dist/rar-stream.umd.min.js"></script>

    <style>
        :root {
            --bg-color: #121212;
            --primary-color: #1e1e1e;
            --secondary-color: #2a2a2a;
            --accent-color: #00aaff;
            --text-color: #e0e0e0;
            --border-color: #444;
            --success-color: #4CAF50;
            --error-color: #F44336;
        }

        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

      .container {
            width: 100%;
            max-width: 700px;
            background-color: var(--primary-color);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        h1 {
            color: var(--accent-color);
            margin-bottom: 20px;
        }

        p {
            margin-bottom: 30px;
            font-size: 1.1em;
            color: #aaa;
        }

        #drop-area {
            border: 3px dashed var(--border-color);
            border-radius: 10px;
            padding: 50px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        #drop-area.highlight {
            border-color: var(--accent-color);
            background-color: var(--secondary-color);
        }

        #file-input {
            display: none;
        }

      .button {
            background-color: var(--accent-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

      .button:hover {
            background-color: #0088cc;
        }

        #status {
            margin-top: 20px;
            font-size: 1.1em;
            min-height: 25px;
        }

        #file-list {
            margin-top: 30px;
            text-align: right;
            max-height: 400px;
            overflow-y: auto;
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
        }

      .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
      .file-item:last-child {
            border-bottom: none;
        }

      .file-name {
            font-weight: bold;
            word-break: break-all;
        }
        
      .folder-name {
            color: #f0e68c; /* Khaki for folders */
        }

      .download-link {
            color: var(--success-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
            white-space: nowrap;
            margin-right: 10px;
        }
        
      .download-link:hover {
            color: #66bb6a;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>أداة فك الضغط الفورية</h1>
        <p>اسحب وأدرج ملف ZIP أو RAR هنا، أو اضغط للاختيار.</p>

        <div id="drop-area">
            <p>ألقِ الملف هنا</p>
            <button class="button" onclick="document.getElementById('file-input').click()">اختر ملف</button>
            <input type="file" id="file-input" accept=".zip,.rar">
        </div>

        <div id="status"></div>
        <div id="file-list"></div>
    </div>

    <script>
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const statusDiv = document.getElementById('status');
        const fileListDiv = document.getElementById('file-list');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.add('highlight'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.remove('highlight'), false);
        });

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            handleFiles(e.dataTransfer.files);
        }

        fileInput.addEventListener('change', function() {
            handleFiles(this.files);
        });

        function handleFiles(files) {
            if (files.length === 0) return;
            const file = files[0];
            const fileName = file.name.toLowerCase();

            statusDiv.style.color = 'var(--accent-color)';
            statusDiv.textContent = `جاري فك ضغط: ${file.name}`;
            fileListDiv.innerHTML = '';

            if (fileName.endsWith('.zip')) {
                unzipFile(file);
            } else if (fileName.endsWith('.rar')) {
                unrarFile(file);
            } else {
                statusDiv.style.color = 'var(--error-color)';
                statusDiv.textContent = 'خطأ: يُرجى اختيار ملف من نوع ZIP أو RAR.';
            }
        }
        
        function displayFile(entryName, isDirectory, contentBlob) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';

            const fileNameSpan = document.createElement('span');
            fileNameSpan.className = 'file-name';
            fileNameSpan.textContent = entryName;
            fileItem.appendChild(fileNameSpan);

            if (isDirectory) {
                fileNameSpan.classList.add('folder-name');
            } else {
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(contentBlob);
                downloadLink.download = entryName.split('/').pop();
                downloadLink.textContent = 'تحميل';
                downloadLink.className = 'download-link';
                fileItem.appendChild(downloadLink);
            }
            fileListDiv.appendChild(fileItem);
        }

        function unzipFile(file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                JSZip.loadAsync(event.target.result)
                  .then(function(zip) {
                        statusDiv.style.color = 'var(--success-color)';
                        statusDiv.textContent = 'تم فك الضغط بنجاح!';
                        let fileCount = 0;
                        zip.forEach(function (relativePath, zipEntry) {
                            fileCount++;
                            if (!zipEntry.dir) {
                                zipEntry.async('blob').then(content => {
                                    displayFile(zipEntry.name, false, content);
                                });
                            } else {
                                displayFile(zipEntry.name, true, null);
                            }
                        });
                        if(fileCount === 0) statusDiv.textContent = 'الملف المضغوط فارغ.';
                    })
                  .catch(err => {
                        statusDiv.style.color = 'var(--error-color)';
                        statusDiv.textContent = 'خطأ أثناء فك ضغط ZIP: ' + err.message;
                    });
            };
            reader.readAsArrayBuffer(file);
        }

        async function unrarFile(file) {
            try {
                const stream = RarStream.createStream(file);
                let fileCount = 0;
                stream.on('entry', (entry, next) => {
                    fileCount++;
                    const chunks = [];
                    entry.on('data', chunk => chunks.push(chunk));
                    entry.on('end', () => {
                        const blob = new Blob(chunks);
                        displayFile(entry.name, entry.isDirectory, blob);
                        next();
                    });
                });

                stream.on('end', () => {
                     if (fileCount > 0) {
                        statusDiv.style.color = 'var(--success-color)';
                        statusDiv.textContent = 'تم فك الضغط بنجاح!';
                    } else {
                        statusDiv.textContent = 'ملف RAR فارغ أو لا يمكن قراءته.';
                    }
                });

                 stream.on('error', (err) => {
                     throw err;
                 });

            } catch (err) {
                 statusDiv.style.color = 'var(--error-color)';
                 statusDiv.textContent = 'خطأ فادح أثناء فك ضغط RAR: ' + err.message;
            }
        }
    </script>
</body>
</html>